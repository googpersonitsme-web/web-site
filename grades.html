<!doctype html>
<html lang="uk">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Виставлення оцінок">
    <title>Журнал Успішності - Оцінки</title>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="header">	 
            <div class="logo">	 
                <div class="logo__Text">
                    PRO100
                </div>
                <div class="logo__Image"></div>
            </div>
        </div>	 
    </header>
    
    <nav class="menu">
        <a href="index.html" class="menu__link">ГОЛОВНА</a> | 
        <a href="students.html" class="menu__link">СТУДЕНТИ</a> |
        <a href="subjects.html" class="menu__link">ПРЕДМЕТИ</a> |
        <a href="grades.html" class="menu__link_active">ОЦІНКИ</a> |
        <a href="gallery.html" class="menu__link">ГАЛЕРЕЯ</a> |
        <a href="statistics.html" class="menu__link">СТАТИСТИКА</a>
    </nav>
    
    <main>
        <div class="grid-container">
            <div class="grid-item">
                <h2>Виставити оцінку</h2>
                <form id="addGradeForm">
                    <label for="selectStudent">Студент:</label>
                    <select id="selectStudent" name="selectStudent" required>
                        <option value="">Оберіть студента</option>
                    </select>
                    
                    <label for="selectSubject">Предмет:</label>
                    <select id="selectSubject" name="selectSubject" required>
                        <option value="">Оберіть предмет</option>
                    </select>
                    
                    <label for="gradeValue">Оцінка:</label>
                    <select id="gradeValue" name="gradeValue" required>
                        <option value="">Оберіть оцінку</option>
                        <option value="100">100 (Відмінно)</option>
                        <option value="95">95</option>
                        <option value="90">90 (Дуже добре)</option>
                        <option value="85">85</option>
                        <option value="80">80 (Добре)</option>
                        <option value="75">75</option>
                        <option value="70">70 (Задовільно)</option>
                        <option value="65">65</option>
                        <option value="60">60</option>
                        <option value="50">50 (Незадовільно)</option>
                        <option value="0">0 (Не з'явився)</option>
                    </select>
                    
                    <label for="gradeType">Тип оцінки:</label>
                    <select id="gradeType" name="gradeType" required>
                        <option value="Контрольна робота">Контрольна робота</option>
                        <option value="Лабораторна робота">Лабораторна робота</option>
                        <option value="Практична робота">Практична робота</option>
                        <option value="Самостійна робота">Самостійна робота</option>
                        <option value="Іспит">Іспит</option>
                        <option value="Залік">Залік</option>
                        <option value="Домашнє завдання">Домашнє завдання</option>
                    </select>
                    
                    <label for="gradeDate">Дата:</label>
                    <input type="date" id="gradeDate" name="gradeDate" required>
                    
                    <label for="gradeComment">Коментар (необов'язково):</label>
                    <textarea id="gradeComment" name="gradeComment" rows="2" placeholder="Додатковий коментар"></textarea>
                    
                    <button type="submit">Додати оцінку</button>
                </form>
                <div id="formMessage" class="message"></div>
            </div>
            
            <div class="grid-item" style="grid-column: span 2;">
                <article>
                    <h2>Всі оцінки</h2>
                    
                    <div class="filter-container">
                        <select id="filterStudent" class="filter-select">
                            <option value="">Всі студенти</option>
                        </select>
                        
                        <select id="filterSubject" class="filter-select">
                            <option value="">Всі предмети</option>
                        </select>
                        
                        <input type="text" id="searchGrade" placeholder="Пошук..." class="search-input">
                    </div>
                    
                    <div id="gradesList" class="data-table-container">
                        <p>Оцінок поки немає. Додайте першу оцінку!</p>
                    </div>
                    
                    <div id="gradesStats" class="stats-summary">
                        <p>Всього оцінок: <strong id="gradesCount">0</strong></p>
                        <p>Середній бал: <strong id="averageGrade">-</strong></p>
                    </div>
                </article>
            </div>
        </div>
    </main>
    
    <div class="grade_service">
        <div class="grade_service__column">
            <div class="grade_service__row">
                <div class="grade_service__cell1" style="flex-basis: calc(50% - 0.5px)"></div>
                <div class="grade_service__cell2" style="flex-basis: calc(50% - 0.5px)"></div>
            </div>
            <div class="grade_service__row">
                <div class="grade_service__cell3" style="flex-basis: calc(100% / 3)"></div>
                <div class="grade_service__cell4" style="flex-basis: calc(100% / 3)"></div>
                <div class="grade_service__cell5" style="flex-basis: calc(100% / 3)"></div>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="footer_text">
            &#169; Журнал Успішності 2025
        </div>
    </footer>
    
    <script src="js/app.js"></script>
    <script>
        let students = JSON.parse(localStorage.getItem('students')) || [];
        let subjects = JSON.parse(localStorage.getItem('subjects')) || [];
        let grades = JSON.parse(localStorage.getItem('grades')) || [];

        document.addEventListener('DOMContentLoaded', function() {
            loadStudentsAndSubjects();
            displayGrades();
            updateGradesStats();
            setTodayDate();
        });

        function setTodayDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('gradeDate').value = today;
        }

        function loadStudentsAndSubjects() {
            const studentSelect = document.getElementById('selectStudent');
            const subjectSelect = document.getElementById('selectSubject');
            const filterStudent = document.getElementById('filterStudent');
            const filterSubject = document.getElementById('filterSubject');
            
            
            students.forEach(student => {
                const option1 = new Option(`${student.name} (${student.group})`, student.id);
                const option2 = new Option(`${student.name} (${student.group})`, student.id);
                studentSelect.add(option1);
                filterStudent.add(option2);
            });
            
           
            subjects.forEach(subject => {
                const option1 = new Option(subject.name, subject.id);
                const option2 = new Option(subject.name, subject.id);
                subjectSelect.add(option1);
                filterSubject.add(option2);
            });
        }

        
        document.getElementById('addGradeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const studentId = parseInt(document.getElementById('selectStudent').value);
            const subjectId = parseInt(document.getElementById('selectSubject').value);
            const gradeValue = parseInt(document.getElementById('gradeValue').value);
            const gradeType = document.getElementById('gradeType').value;
            const gradeDate = document.getElementById('gradeDate').value;
            const comment = document.getElementById('gradeComment').value.trim();
            
            const grade = {
                id: Date.now(),
                studentId: studentId,
                subjectId: subjectId,
                grade: gradeValue,
                type: gradeType,
                date: gradeDate,
                comment: comment,
                dateAdded: new Date().toLocaleDateString('uk-UA')
            };
            
            grades.push(grade);
            localStorage.setItem('grades', JSON.stringify(grades));
            
            document.getElementById('addGradeForm').reset();
            setTodayDate();
            showMessage('Оцінку успішно додано!', 'success');
            displayGrades();
            updateGradesStats();
        });

        
        document.getElementById('filterStudent').addEventListener('change', applyFilters);
        document.getElementById('filterSubject').addEventListener('change', applyFilters);
        document.getElementById('searchGrade').addEventListener('input', applyFilters);

        function applyFilters() {
            const studentFilter = document.getElementById('filterStudent').value;
            const subjectFilter = document.getElementById('filterSubject').value;
            const searchTerm = document.getElementById('searchGrade').value.toLowerCase();
            
            let filtered = grades;
            
            if (studentFilter) {
                filtered = filtered.filter(g => g.studentId == studentFilter);
            }
            
            if (subjectFilter) {
                filtered = filtered.filter(g => g.subjectId == subjectFilter);
            }
            
            if (searchTerm) {
                filtered = filtered.filter(grade => {
                    const student = students.find(s => s.id === grade.studentId);
                    const subject = subjects.find(s => s.id === grade.subjectId);
                    return (student && student.name.toLowerCase().includes(searchTerm)) ||
                           (subject && subject.name.toLowerCase().includes(searchTerm)) ||
                           grade.type.toLowerCase().includes(searchTerm);
                });
            }
            
            displayGrades(filtered);
        }

        function displayGrades(gradesToShow = grades) {
            const container = document.getElementById('gradesList');
            
            if (gradesToShow.length === 0) {
                container.innerHTML = '<p>Оцінок не знайдено</p>';
                return;
            }
            
        
            gradesToShow.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let html = '<table class="data-table"><thead><tr><th>Студент</th><th>Предмет</th><th>Оцінка</th><th>Тип</th><th>Дата</th><th>Коментар</th><th>Дії</th></tr></thead><tbody>';
            
            gradesToShow.forEach(grade => {
                const student = students.find(s => s.id === grade.studentId);
                const subject = subjects.find(s => s.id === grade.subjectId);
                
                const gradeClass = grade.grade >= 90 ? 'grade-excellent' : 
                                   grade.grade >= 75 ? 'grade-good' : 
                                   grade.grade >= 60 ? 'grade-satisfactory' : 'grade-fail';
                
                html += `
                    <tr>
                        <td>${student ? student.name : 'Невідомо'}</td>
                        <td>${subject ? subject.name : 'Невідомо'}</td>
                        <td class="${gradeClass}"><strong>${grade.grade}</strong></td>
                        <td>${grade.type}</td>
                        <td>${grade.date}</td>
                        <td>${grade.comment || '-'}</td>
                        <td>
                            <button onclick="editGrade(${grade.id})" class="btn-edit">Редагувати</button>
                            <button onclick="deleteGrade(${grade.id})" class="btn-delete">Видалити</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function deleteGrade(id) {
            if (confirm('Ви впевнені, що хочете видалити цю оцінку?')) {
                grades = grades.filter(grade => grade.id !== id);
                localStorage.setItem('grades', JSON.stringify(grades));
                
                showMessage('Оцінку видалено', 'success');
                displayGrades();
                updateGradesStats();
            }
        }

        function editGrade(id) {
            const grade = grades.find(g => g.id === id);
            if (grade) {
                const newGrade = prompt('Введіть нову оцінку (0-100):', grade.grade);
                if (newGrade !== null && !isNaN(newGrade)) {
                    const gradeValue = parseInt(newGrade);
                    if (gradeValue >= 0 && gradeValue <= 100) {
                        grade.grade = gradeValue;
                        
                        const newComment = prompt('Введіть коментар:', grade.comment);
                        grade.comment = newComment ? newComment.trim() : '';
                        
                        localStorage.setItem('grades', JSON.stringify(grades));
                        showMessage('Оцінку оновлено', 'success');
                        displayGrades();
                        updateGradesStats();
                    } else {
                        alert('Оцінка має бути від 0 до 100');
                    }
                }
            }
        }

        function updateGradesStats() {
            document.getElementById('gradesCount').textContent = grades.length;
            
            if (grades.length > 0) {
                const average = grades.reduce((sum, grade) => sum + grade.grade, 0) / grades.length;
                document.getElementById('averageGrade').textContent = average.toFixed(2);
            } else {
                document.getElementById('averageGrade').textContent = '-';
            }
        }

        function showMessage(text, type) {
            const messageDiv = document.getElementById('formMessage');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            setTimeout(() => {
                messageDiv.textContent = '';
                messageDiv.className = 'message';
            }, 3000);
        }
    </script>
</body>
</html>